$(function(){$(".numbering-row, .ext-row").hide(),$("#toggleOptions").on("click",function(){$(".numbering-row, .ext-row").each(function(){$(this).slideToggle(300)})}),$(document).on("click","#copyTs",function(){const n=$("#fileList li:not(.header)");if(0===n.length)return void alert("コピーするタイムスタンプがありません");const e=i(),t=[];n.each(function(n){const a=$(this).find(".ts").text(),i=$(this).find(".name").text();"head"===e?t.push(`${n+1} ${a} ${i}`):"beforeName"===e?t.push(`${a} ${n+1} ${i}`):t.push(`${a} ${i}`)}),navigator.clipboard.writeText(t.join("\n")).then(()=>{alert("タイムスタンプをコピーしました")})}),$(document).on("change",'input[name="extOption"]',function(){const n=$('input[name="extOption"]:checked').val();$("#fileList").children("li").each(function(){const e=$(this);let t=e.data("filename")||e.find(".name").text();t=t.split(/[/\\]/).pop(),"none"===n&&(t=t.replace(/\.[^/.]+$/,"")),e.find(".name").text(t)})});const n=$("#fileInput");function e(n){const e=Object.keys(n.files).find(n=>n.endsWith("timeline.wesproj"));e?n.files[e].async("string").then(t):alert("timeline.wesproj ファイルがzip内に見つかりません")}function t(n){const e=$("#fileList");e.empty();const t=i();e.append(s(t));try{const i=JSON.parse(n),s=[];o(i,s),s.length>0?(s.sort((n,e)=>{const t=Number(n.tlBegin),a=Number(e.tlBegin);return isNaN(t)||isNaN(a)?0:t-a}),s.forEach((n,i)=>{e.append(a(n,i,t))})):e.append("<li>filenameとtlBeginが見つかりませんでした。</li>")}catch(n){e.append("<li>JSONのパースに失敗しました。</li>")}}function a(n,e,t){const a=document.createElement("li");a.classList.add("data-row");const i=document.createElement("span");i.className="num";const s=document.createElement("span");s.className="ts";const o=document.createElement("span");var c;return o.className="name",i.textContent=e+1,s.textContent=function(n){const e=Number(n);if(isNaN(e))return n;let t=Math.floor(e/1e7);const a=Math.floor(t/3600),i=Math.floor(t%3600/60),s=t%60;return`${a.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}(n.tlBegin),o.textContent="string"!=typeof(c=n.filename)?c:c.split(/[/\\]/).pop(),a.dataset.filename=n.filename,"head"===t?a.append(i,s,o):"beforeName"===t?a.append(s,i,o):a.append(s,o),a}function i(){const n=document.querySelector('input[name="numbering"]:checked');return n?n.value:"none"}function s(n){return"head"===n?'<li class="header"><span class="num">No</span><span class="ts">開始時間</span><span class="name">ファイル名</span></li>':"beforeName"===n?'<li class="header"><span class="ts">開始時間</span><span class="num">No</span><span class="name">ファイル名</span></li>':'<li class="header"><span class="ts">開始時間</span><span class="name">ファイル名</span></li>'}function o(n,e){if(null==n||"object"!=typeof n)return;"filename"in n&&"tlBegin"in n&&"string"==typeof n.filename&&(n.filename.toLowerCase().endsWith(".mp3")||n.filename.toLowerCase().endsWith(".wav"))&&e.push({filename:n.filename,tlBegin:n.tlBegin});for(const t in n)o(n[t],e)}0!==n.length&&(n.on("change",function(n){const t=n.target.files[0];t&&(t.name.endsWith(".wfp")?function(n){const t=new FileReader;t.onload=function(n){JSZip.loadAsync(n.target.result).then(e)},t.readAsArrayBuffer(n)}(t):alert("WFPファイルを選択してください"))}),$(document).on("change",'input[name="numbering"]',function(){const n=$("#fileList"),e=n.children("li:not(.header)").toArray().map(n=>({filename:$(n).data("filename")||$(n).find(".name").text(),tlBegin:$(n).find(".ts").text()}));n.empty();const t=i();n.append(s(t)),e.forEach((e,i)=>{n.append(a(e,i,t))})}))});